=== Usergrid Tools

==== 概况

Usergrid Tools 的用途：

* 保存聊天记录，供 REST 接口查询
* 离线消息的 APNS 推送

Usergrid Tools 处理的数据来源为 Ejabberd。
Ejabberd 处理消息后，将消息写入 Redis 中的两个队列。
`ejabberd:chat:messages` 队列由 Tools 读取后，保存到Cassandra中。
`ejabberd:chat:offlines` 队列由 Tools 读取后，经处理组装成新的格式用于推送，写入 Redis 中的 `usergrid:apns:todo` 队列。
`usergrid:apns:todo` 队列由 Tools 再次读取后，向 apns 服务器发起推送请求。

==== 基础环境

Java 8

==== 基本操作命令

启动
[source,console]
----
sudo monit start tools
----

停止
[source,console]
----
sudo monit stop tools
----

==== 业务代码更新（CI）

CI 中执行 ansible-playbook 用于更新。

对应 ansible 的 role 为 `ci/usergrid_tools`，依赖 role `ci/usergrid_properties`。

变量 `usergrid_tools_topic` 用于在多节点环境中区分每个节点处理的队列名。

变量默认值：

[source]
----
usergrid_tools_link: http://ebs-ali-beijing-log/usergrid-tools
usergrid_tools_file: usergrid-tools-1.0.0-release.tar.gz
usergrid_tools_dir: usergrid-tools-1.0.0
usergrid_tools_path: /data/apps/opt/usergrid-tools
usergrid_tools_topic: "ejabberd:chat:messages usergrid:apns:todo ejabberd:chat:offlines"
Xms: "4g"
Xmx: "4g"
----

==== 日志与监控

日志路径为 `/data/apps/log/usergrid/usergrid.log`

==== 参数优化
