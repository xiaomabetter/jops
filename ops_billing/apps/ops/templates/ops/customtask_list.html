{% extends '_base_list.html' %}
{% load i18n %}
{% load static %}

{% block table_search %}
{% endblock %}

{% block table_head %}
    <th class="text-center">任务名称</th>
    <th class="text-center">参数</th>
{% endblock %}

{% block table_body %}
        <tr class="gradeX">
            <td class="text-center">同步阿里云费用清单</td>
            <td class="text-center">
                <form id="sync_bill" method="get" action="" class="form-inline">
                    <div class="form-group hidden">
                        <input type="text"  class="form-control" name="taskname" value="sync_bill">
                    </div>
                    <div class="form-group" id="datebillselect">
                        选择时间范围:
                        <div class="input-daterange input-group" id="datepicker">
                            <span class="input-group-addon">From</span>
                            <input type="text" class="input-sm form-control" style="width: 150px;" name="day_from" value="{{ date_from|date:'Y-m-d' }}">
                            <span class="input-group-addon">To</span>
                            <input type="text" class="input-sm form-control" style="width: 150px;" name="day_to" value="{{ date_to|date:'Y-m-d' }}">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button id="alisync_bill" style="height:30px;width:100px" type="submit" class="btn btn-sm btn-primary">
                                运行
                            </button>
                        </div>
                    </div>
                </form>
            </td>
        </tr>
        <tr class="gradeX">
            <td class="text-center">同步阿里云资产</td>
            <td class="text-center">
                <form id="sync_asset" method="get" action="" class="form-inline">
                    <div class="form-group hidden">
                        <input type="text"  class="form-control" name="taskname" value="sync_asset">
                    </div>
                    <div class="form-group">
                            选择资产类型:
                            <select name="asset_category" class="selectpicker" >
                                <option>ecs</option>
                                <option>slb</option>
                            </select>
                    </div>
                    <div class="input-group">
                        <div class="input-group-btn">
                            <button  id="alisync_asset" style="height:30px;width:100px"  class="btn btn-sm btn-primary">
                                运行
                            </button>
                        </div>
                    </div>
                </form>
            </td>
        </tr>
{% endblock %}

{% block custom_foot_js %}
<script src="{% static 'js/plugins/datepicker/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'js/plugins/honeySwitch/bootstrap-select.min.js' %}"></script>

<script>
$(document).ready(function() {
    $('#datebillselect .input-daterange').datepicker({
        format: "yyyy-mm-dd",
        todayBtn: "linked",
        keyboardNavigation: false,
        forceParse: false,
        calendarWeeks: true,
        autoclose: true
    });
})
.on('click', '#alisync_bill', function () {
    var the_url = "{% url 'ops:task-custom' %}";
    var data = $('#sync_bill').serialize()
    var error = function (data) {
        alert("begin")
    };
    var success = function(data) {
        var task_id = data.task;
        var url = '{% url "ops:celery-task-log" pk=DEFAULT_PK %}'.replace("{{ DEFAULT_PK }}", task_id);
        window.open(url, '', 'width=800,height=600')
    };
    APIUpdateAttr({
        url: the_url,
        error: error,
        method: 'GET',
        body:data,
        success: success,
        success_message: "{% trans 'Task start: ' %}" + " " + "同步阿里云费用清单"
    });
})
.on('click', '#alisync_asset', function () {
    var the_url = "{% url 'ops:task-custom' %}";
    var data = $('#sync_asset').serialize()
    var error = function (data) {
        alert("begin")
    };
    var success = function(data) {
        var task_id = data.task;
        var url = '{% url "ops:celery-task-log" pk=DEFAULT_PK %}'.replace("{{ DEFAULT_PK }}", task_id);
        window.open(url, '', 'width=800,height=600')
    };
    APIUpdateAttr({
        url: the_url,
        error: error,
        method: 'GET',
        body:data,
        success: success,
        success_message: "{% trans 'Task start: ' %}" + " " + "同步阿里云费用清单"
    });
})

</script>
{% endblock %}

