{% extends 'base/_base_list.html' %}
{% block table_container %}
<div class="uc pull-left m-r-5"><a href="{{ url_for('user.users_create')}}" class="btn btn-sm btn-primary">创建用户</a></div>
<table class="table table-striped table-bordered table-hover " id="user_list_table" >
    <thead>
        <tr>
            <th class="text-center">
                <input id="" type="checkbox" class="ipt_check_all">
            </th>
            <th class="text-center">用户名</th>
            <th class="text-center">邮箱</th>
            <th class="text-center">用户组</th>
            <th class="text-center">用户角色</th>
            <th class="text-center">激活中</th>
            <th class="text-center">动作</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
{% include "user/_user_import_modal.html" %}
{% endblock %}
{% block content_bottom_left %}{% endblock %}
{% block custom_foot_js %}
<script src="{{ url_for('static', filename='js/jquery.form.min.js') }}"></script>
<script>

function initTable() {
     var options = {
        ele: $('#user_list_table'),
        columnDefs: [
             {targets: 1, createdCell: function (td, cellData, rowData) {
                var detail_btn = '<a href="{{ url_for('user.users_detail',userid='PK')}}">' + cellData + '</a>';
                $(td).html(detail_btn.replace("PK", rowData.id));
             }},
             {targets: 3, createdCell: function (td, cellData, rowData) {
                var groups = new Array;
                cellData.forEach(function(e) {
                   groups.push(e.groupname);
                })
                $(td).html(groups.toString());
             }},
             {targets: 5, createdCell: function (td, cellData) {
                if (cellData) {
                    $(td).html('<i class="fa fa-check text-navy"></i>')
                } else {
                    $(td).html('<i class="fa fa-times text-danger"></i>')
                }
             }},
             {targets: 6, createdCell: function (td, cellData, rowData) {
                var update_btn = '<a class="btn btn-xs m-l-xs btn-info btn-forbid" data-uid="PK">禁用</a>'.replace('PK', cellData);
                var del_btn = '<a class="btn btn-xs btn-danger m-l-xs btn-del" data-uid="PK">删除</a>'.replace('PK', cellData);
                $(td).html(update_btn + del_btn);
             }},
             ],
        ajax_url: "{{ url_for('user-api.users_api') }}",
        columns: [
            {data: "id"},{data: "username" },{data: "email" },{data: "group" },
            {data: "role" },{data: "is_active" },{data: "id" }
        ],
        op_html: $('#actions').html()
    };
    table = jumpserver.initDataTable(options);
    return table
}

$(document).ready(function(){
    var table = initTable();
    var fields = $('#fm_user_bulk_update .form-group');
    $.each(fields, function (index, value) {
        console.log(value)
    });
}).on('click', '.btn-forbid', function(){
    var $this = $(this);
    var uid = $this.data('uid');
    var the_url = "{{ url_for('user-api.user_api',userid='PK') }}".replace('PK',uid);
    APIUpdateAttr({
        url: the_url,
        method: "PATCH"
    })
}).on('click', '.btn-del', function(){
    var $this = $(this);
    var name = $this.data('username');
    var uid = $this.data('uid');
    var the_url = "{{ url_for('user-api.user_api',userid='PK') }}".replace('PK',uid);
    objectDelete($this, name, the_url);
})
</script>
{% endblock %}

